LightboxOptions=Object.extend({fileLoadingImage:"/assets/spinners/spinner_grande.gif",fileBottomNavCloseImage:"/assets/lightbox/closelabel.gif",overlayOpacity:.8,animate:!0,resizeSpeed:7,borderSize:10,labelImage:"Imagem",labelOf:"de"},window.LightboxOptions||{});var Lightbox=Class.create();Lightbox.prototype={imageArray:[],activeImage:void 0,initialize:function(){this.updateImageList(),this.keyboardAction=this.keyboardAction.bindAsEventListener(this),LightboxOptions.resizeSpeed>10&&(LightboxOptions.resizeSpeed=10),LightboxOptions.resizeSpeed<1&&(LightboxOptions.resizeSpeed=1),this.resizeDuration=LightboxOptions.animate?.15*(11-LightboxOptions.resizeSpeed):0,this.overlayDuration=LightboxOptions.animate?.2:0;var e=(LightboxOptions.animate?250:1)+"px",t=$$("body")[0];t.appendChild(Builder.node("div",{id:"overlay"})),t.appendChild(Builder.node("div",{id:"lightbox"},[Builder.node("div",{id:"outerImageContainer"},Builder.node("div",{id:"imageContainer"},[Builder.node("img",{id:"lightboxImage"}),Builder.node("div",{id:"hoverNav"},[Builder.node("a",{id:"prevLink",href:"#"}),Builder.node("a",{id:"nextLink",href:"#"})]),Builder.node("div",{id:"loading"},Builder.node("a",{id:"loadingLink",href:"#"},Builder.node("img",{src:LightboxOptions.fileLoadingImage})))])),Builder.node("div",{id:"imageDataContainer"},Builder.node("div",{id:"imageData"},[Builder.node("div",{id:"imageDetails"},[Builder.node("span",{id:"caption"}),Builder.node("span",{id:"numberDisplay"})]),Builder.node("div",{id:"bottomNav"},Builder.node("a",{id:"bottomNavClose",href:"#"},Builder.node("img",{src:LightboxOptions.fileBottomNavCloseImage})))]))])),$("overlay").hide().observe("click",function(){this.end()}.bind(this)),$("lightbox").hide().observe("click",function(e){"lightbox"==e.element().id&&this.end()}.bind(this)),$("outerImageContainer").setStyle({width:e,height:e}),$("prevLink").observe("click",function(e){e.stop(),this.changeImage(this.activeImage-1)}.bindAsEventListener(this)),$("nextLink").observe("click",function(e){e.stop(),this.changeImage(this.activeImage+1)}.bindAsEventListener(this)),$("loadingLink").observe("click",function(e){e.stop(),this.end()}.bind(this)),$("bottomNavClose").observe("click",function(e){e.stop(),this.end()}.bind(this));var i=this;(function(){var e="overlay lightbox outerImageContainer imageContainer lightboxImage hoverNav prevLink nextLink loading loadingLink imageDataContainer imageData imageDetails caption numberDisplay bottomNav bottomNavClose";$w(e).each(function(e){i[e]=$(e)})}).defer()},updateImageList:function(){this.updateImageList=Prototype.emptyFunction,document.observe("click",function(e){var t=e.findElement("a[rel^=lightbox]")||e.findElement("area[rel^=lightbox]");t&&(e.stop(),this.start(t))}.bind(this))},start:function(e){$$("select","object","embed").each(function(e){e.style.visibility="hidden"});var t=this.getPageSize();$("overlay").setStyle({width:t[0]+"px",height:t[1]+"px"}),new Effect.Appear(this.overlay,{duration:this.overlayDuration,from:0,to:LightboxOptions.overlayOpacity}),this.imageArray=[];var i=0;if("lightbox"==e.rel)this.imageArray.push([e.href,e.title]);else for(this.imageArray=$$(e.tagName+'[href][rel="'+e.rel+'"]').collect(function(e){return[e.href,e.title]}).uniq();this.imageArray[i][0]!=e.href;)i++;var n=document.viewport.getScrollOffsets(),s=n[1]+document.viewport.getHeight()/10,o=n[0];this.lightbox.setStyle({top:s+"px",left:o+"px"}).show(),this.changeImage(i)},changeImage:function(e){this.activeImage=e,LightboxOptions.animate&&this.loading.show(),this.lightboxImage.hide(),this.hoverNav.hide(),this.prevLink.hide(),this.nextLink.hide(),this.imageDataContainer.setStyle({opacity:1e-4}),this.numberDisplay.hide();var t=new Image;t.onload=function(){this.lightboxImage.src=this.imageArray[this.activeImage][0],this.resizeImageContainer(t.width,t.height)}.bind(this),t.src=this.imageArray[this.activeImage][0]},resizeImageContainer:function(e,t){var i=this.outerImageContainer.getWidth(),n=this.outerImageContainer.getHeight(),s=e+2*LightboxOptions.borderSize,o=t+2*LightboxOptions.borderSize,r=s/i*100,a=o/n*100,l=i-s,c=n-o;0!=c&&new Effect.Scale(this.outerImageContainer,a,{scaleX:!1,duration:this.resizeDuration,queue:"front"}),0!=l&&new Effect.Scale(this.outerImageContainer,r,{scaleY:!1,duration:this.resizeDuration,delay:this.resizeDuration});var u=0;0==c&&0==l&&(u=100,Prototype.Browser.IE&&(u=250)),function(){this.prevLink.setStyle({height:t+"px"}),this.nextLink.setStyle({height:t+"px"}),this.imageDataContainer.setStyle({width:s+"px"}),this.showImage()}.bind(this).delay(u/1e3)},showImage:function(){this.loading.hide(),new Effect.Appear(this.lightboxImage,{duration:this.resizeDuration,queue:"end",afterFinish:function(){this.updateDetails()}.bind(this)}),this.preloadNeighborImages()},updateDetails:function(){""!=this.imageArray[this.activeImage][1]&&this.caption.update(this.imageArray[this.activeImage][1]).show(),this.imageArray.length>1&&this.numberDisplay.update(LightboxOptions.labelImage+" "+(this.activeImage+1)+" "+LightboxOptions.labelOf+"  "+this.imageArray.length).show(),new Effect.Parallel([new Effect.SlideDown(this.imageDataContainer,{sync:!0,duration:this.resizeDuration,from:0,to:1}),new Effect.Appear(this.imageDataContainer,{sync:!0,duration:this.resizeDuration})],{duration:this.resizeDuration,afterFinish:function(){var e=this.getPageSize();this.overlay.setStyle({height:e[1]+"px"}),this.updateNav()}.bind(this)})},updateNav:function(){this.hoverNav.show(),this.activeImage>0&&this.prevLink.show(),this.activeImage<this.imageArray.length-1&&this.nextLink.show(),this.enableKeyboardNav()},enableKeyboardNav:function(){document.observe("keydown",this.keyboardAction)},disableKeyboardNav:function(){document.stopObserving("keydown",this.keyboardAction)},keyboardAction:function(e){var t,i=e.keyCode;t=e.DOM_VK_ESCAPE?e.DOM_VK_ESCAPE:27;var n=String.fromCharCode(i).toLowerCase();n.match(/x|o|c/)||i==t?this.end():"p"==n||37==i?0!=this.activeImage&&(this.disableKeyboardNav(),this.changeImage(this.activeImage-1)):"n"!=n&&39!=i||this.activeImage!=this.imageArray.length-1&&(this.disableKeyboardNav(),this.changeImage(this.activeImage+1))},preloadNeighborImages:function(){var e,t;this.imageArray.length>this.activeImage+1&&(e=new Image,e.src=this.imageArray[this.activeImage+1][0]),this.activeImage>0&&(t=new Image,t.src=this.imageArray[this.activeImage-1][0])},end:function(){this.disableKeyboardNav(),this.lightbox.hide(),new Effect.Fade(this.overlay,{duration:this.overlayDuration}),$$("select","object","embed").each(function(e){e.style.visibility="visible"})},getPageSize:function(){var e,t;window.innerHeight&&window.scrollMaxY?(e=window.innerWidth+window.scrollMaxX,t=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(e=document.body.scrollWidth,t=document.body.scrollHeight):(e=document.body.offsetWidth,t=document.body.offsetHeight);var i,n;return self.innerHeight?(i=document.documentElement.clientWidth?document.documentElement.clientWidth:self.innerWidth,n=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(i=document.documentElement.clientWidth,n=document.documentElement.clientHeight):document.body&&(i=document.body.clientWidth,n=document.body.clientHeight),t<n?pageHeight=n:pageHeight=t,e<i?pageWidth=e:pageWidth=i,[pageWidth,pageHeight]}},document.observe("dom:loaded",function(){new Lightbox});